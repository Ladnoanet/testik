<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>—é–∑–µ—Ä—ã</title>
</head>
<body>
    <form id="registerForm">
        <input type="text" id="username" placeholder="–ò–º—è" required>
        <input type="submit" value="–ó–∞—Ä–µ–≥–∞—Ç—å—Å—è">
    </form>

    <div class="users"></div>

    <script>
        const jsonUrl = "https://api.myjson.online/v1/records/def3a3ab-def7-41e3-a80d-472b1a87f2b8";

        const usersContainer = document.querySelector('.users');
        const form = document.getElementById('registerForm');
        const usernameInput = document.getElementById('username');

        // 1. –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        async function loadUsers() {
            const res = await fetch(jsonUrl);
            const data = await res.json();
            const users = data.data.users || [];

            usersContainer.innerHTML = "<h3>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:</h3>" + 
                users.map(user => `<div>üë§ ${user}</div>`).join('');
        }

        // 2. –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function addUser(newName) {
            const res = await fetch(jsonUrl);
            const json = await res.json();
            const users = json.data.users || [];

            users.push(newName); // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–≥–æ

            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ–±—Ä–∞—Ç–Ω–æ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫
            await fetch(jsonUrl, {
                method: "PUT",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ users })
            });

            loadUsers(); // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        }

        // 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã
        form.addEventListener('submit', e => {
            e.preventDefault();
            const name = usernameInput.value.trim();
            if (name) {
                addUser(name);
                usernameInput.value = "";
            }
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        loadUsers();
    </script>
</body>
</html>
