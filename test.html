<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>—é–∑–µ—Ä—ã</title>
</head>
<body>
    <form id="registerForm">
        <input type="text" id="username" placeholder="–ò–º—è" required>
        <input type="submit" value="–ó–∞—Ä–µ–≥–∞—Ç—å—Å—è">
    </form>

    <div class="users"></div>

    <script>
        const jsonUrl = "https://api.myjson.online/v1/records/def3a3ab-def7-41e3-a80d-472b1a87f2b8";
        
        const usersContainer = document.querySelector('.users');
        const form = document.getElementById('registerForm');
        const usernameInput = document.getElementById('username');

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        async function loadUsers() {
            try {
                const res = await fetch(jsonUrl);
                const json = await res.json();
                const users = json.data.users || [];

                usersContainer.innerHTML = "<h3>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:</h3>" +
                    users.map(user => `<div>üë§ ${user}</div>`).join('');
            } catch (err) {
                usersContainer.innerHTML = "<p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</p>";
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:", err);
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function addUser(newName) {
            try {
                const res = await fetch(jsonUrl);
                const json = await res.json();
                const users = json.data.users || [];

                users.push(newName);

                // –û–±–Ω–æ–≤–ª—è–µ–º JSON –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
                await fetch(jsonUrl, {
                    method: "PUT",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        data: {
                            users: users
                        }
                    })
                });

                loadUsers(); // –æ–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            } catch (err) {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:", err);
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã
        form.addEventListener('submit', e => {
            e.preventDefault();
            const name = usernameInput.value.trim();
            if (name) {
                addUser(name);
                usernameInput.value = "";
            }
        });

        // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        loadUsers();
    </script>
</body>
</html>
